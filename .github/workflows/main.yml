concurrency:
  cancel-in-progress: true
  group: ${{ github.head_ref || github.run_id }}-${{ github.base_ref }}
defaults:
  run:
    shell: bash
env:
  CLUSTER_CONFIG: full
  DEFAULT_JAVA_DISTRIBUTION: zulu
  OPTS: -Dtest-unit-sys-prop.ignore.random.failures=true
  test_build_tools: ${{ contains(github.event.pull_request.labels.*.name, 'Ant') ||
    contains(github.event.pull_request.labels.*.name, 'Gradle') || contains(github.event.pull_request.labels.*.name,
    'Maven') || contains(github.event.pull_request.labels.*.name, 'MX') || contains(github.event.pull_request.labels.*.name,
    'ci:all-tests') || github.event_name != 'pull_request' }}
  test_enterprise: ${{ contains(github.event.pull_request.labels.*.name, 'Java EE/Jakarta
    EE') || contains(github.event.pull_request.labels.*.name, 'Micronaut') || contains(github.event.pull_request.labels.*.name,
    'enterprise') || contains(github.event.pull_request.labels.*.name, 'ci:all-tests')
    || github.event_name != 'pull_request' }}
  test_graalvm: ${{ contains(github.event.pull_request.labels.*.name, 'GraalVM') ||
    contains(github.event.pull_request.labels.*.name, 'ci:all-tests') || github.event_name
    != 'pull_request' }}
  test_groovy: ${{ contains(github.event.pull_request.labels.*.name, 'Groovy') ||
    contains(github.event.pull_request.labels.*.name, 'ci:all-tests') || github.event_name
    != 'pull_request' }}
  test_java: ${{ contains(github.event.pull_request.labels.*.name, 'Java') || contains(github.event.pull_request.labels.*.name,
    'ci:all-tests') || github.event_name != 'pull_request' }}
  test_javadoc: ${{ contains(github.event.pull_request.labels.*.name, 'JavaDoc') ||
    contains(github.event.pull_request.labels.*.name, 'API Change') || contains(github.event.pull_request.labels.*.name,
    'ci:all-tests') || github.event_name != 'pull_request' }}
  test_javafx: ${{ contains(github.event.pull_request.labels.*.name, 'JavaFX') ||
    contains(github.event.pull_request.labels.*.name, 'ci:all-tests') || github.event_name
    != 'pull_request' }}
  test_javascript: ${{ contains(github.event.pull_request.labels.*.name, 'JavaScript')
    || contains(github.event.pull_request.labels.*.name, 'ci:all-tests') || github.event_name
    != 'pull_request' }}
  test_lsp: ${{ contains(github.event.pull_request.labels.*.name, 'LSP') || contains(github.event.pull_request.labels.*.name,
    'Gradle') || contains(github.event.pull_request.labels.*.name, 'Maven') || contains(github.event.pull_request.labels.*.name,
    'ci:all-tests') || github.event_name != 'pull_request' }}
  test_php: ${{ contains(github.event.pull_request.labels.*.name, 'PHP') || contains(github.event.pull_request.labels.*.name,
    'ci:all-tests') || github.event_name != 'pull_request' }}
  test_platform: ${{ contains(github.event.pull_request.labels.*.name, 'Platform')
    || contains(github.event.pull_request.labels.*.name, 'ci:all-tests') || github.event_name
    != 'pull_request' }}
  test_rust: ${{ contains(github.event.pull_request.labels.*.name, 'Rust') || contains(github.event.pull_request.labels.*.name,
    'ci:all-tests') || github.event_name != 'pull_request' }}
  test_tests: ${{ contains(github.event.pull_request.labels.*.name, 'tests') || contains(github.event.pull_request.labels.*.name,
    'ci:all-tests') || github.event_name != 'pull_request' }}
  test_versioning: ${{ contains(github.event.pull_request.labels.*.name, 'git') ||
    contains(github.event.pull_request.labels.*.name, 'subversion') || contains(github.event.pull_request.labels.*.name,
    'mercurial') || contains(github.event.pull_request.labels.*.name, 'ci:all-tests')
    || github.event_name != 'pull_request' }}
  test_vscode_extension: ${{ contains(github.event.pull_request.labels.*.name, 'VSCode
    Extension') || contains(github.event.pull_request.labels.*.name, 'ci:all-tests')
    || github.event_name != 'pull_request' }}
  test_web: ${{ contains(github.event.pull_request.labels.*.name, 'JavaScript') ||
    contains(github.event.pull_request.labels.*.name, 'TypeScript') || contains(github.event.pull_request.labels.*.name,
    'HTML') || contains(github.event.pull_request.labels.*.name, 'CSS') || contains(github.event.pull_request.labels.*.name,
    'CSL') || contains(github.event.pull_request.labels.*.name, 'web') || contains(github.event.pull_request.labels.*.name,
    'ci:all-tests') || github.event_name != 'pull_request' }}
jobs:
  apisupport-modules-test:
    name: APISupport Modules on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: apisupport.project
      run: ant $OPTS -f apisupport/apisupport.project test
    - continue-on-error: true
      name: apisupport.refactoring
      run: ant $OPTS -f apisupport/apisupport.refactoring test
    - continue-on-error: true
      name: apisupport.wizards
      run: ant $OPTS -f apisupport/apisupport.wizards test
    - continue-on-error: true
      name: timers
      run: ant $OPTS -f apisupport/timers test -Dtest.config=stable
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '8'
    timeout-minutes: 60
  base-build:
    if: contains(github.event.pull_request.labels.*.name, 'ci:no-build') == false
    name: Build Clusters on JDK ${{ matrix.java }}
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Checkout ${{ github.ref }} ( ${{ github.sha }} )
      uses: actions/checkout@v4
      with:
        persist-credentials: false
        show-progress: false
        submodules: false
    - continue-on-error: true
      name: Caching dependencies
      uses: actions/cache@v4
      with:
        key: ${{ runner.os }}-${{ hashFiles('*/external/binaries-list', '*/*/external/binaries-list')
          }}
        path: ~/.hgexternalcache
        restore-keys: ${{ runner.os }}-
    - continue-on-error: true
      name: Build NetBeans
      run: ant $OPTS -quiet -Dcluster.config=$CLUSTER_CONFIG build-nozip
    - continue-on-error: true
      if: ${{ matrix.java == '17' }}
      name: Prepare Artifact
      run: tar -I 'zstd -9 -T0' -cf /tmp/build.tar.zst --exclude ".git" .
    - continue-on-error: true
      if: ${{ (matrix.java == '17') && success() }}
      name: Upload Workspace
      uses: actions/upload-artifact@v4
      with:
        compression-level: 0
        if-no-files-found: error
        name: build
        path: /tmp/build.tar.zst
        retention-days: 2
    - continue-on-error: true
      if: ${{ matrix.java == '17' && contains(github.event.pull_request.labels.*.name,
        'ci:dev-build') && success() }}
      name: Create Dev Build
      run: ant $OPTS -quiet -Dcluster.config=$CLUSTER_CONFIG zip-cluster-config
    - continue-on-error: true
      if: ${{ matrix.java == '17' && contains(github.event.pull_request.labels.*.name,
        'ci:dev-build') && success() }}
      name: Upload Dev Build
      uses: actions/upload-artifact@v4
      with:
        compression-level: 0
        if-no-files-found: error
        name: dev-build
        path: nbbuild/NetBeans-*.zip
        retention-days: 7
    strategy:
      fail-fast: false
      matrix:
        exclude:
        - java: ${{ github.event_name == 'pull_request' && 'nothing' || '21' }}
        java:
        - '17'
        - '21'
        - '22'
    timeout-minutes: 40
  build-from-src-zip:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'Platform') || contains(github.event.pull_request.labels.*.name,
      'VSCode Extension') || contains(github.event.pull_request.labels.*.name, 'ci:all-tests')
      || github.event_name != 'pull_request' }}
    name: Build ${{ matrix.config }} from src.zip on JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: Restoring Cache
      uses: actions/cache/restore@v4
      with:
        key: ${{ runner.os }}-${{ hashFiles('*/external/binaries-list', '*/*/external/binaries-list')
          }}
        path: ~/.hgexternalcache
        restore-keys: ${{ runner.os }}-
    - continue-on-error: true
      name: Create ${{ matrix.config }}-src zip
      run: ant $OPTS -quiet build-source-config -Dcluster.config=${{ matrix.config
        }}
    - continue-on-error: true
      name: Extract ${{ matrix.config }}-src zip
      run: 'mkdir tmpbuild && cd tmpbuild

        unzip -qq ../nbbuild/build/${{ matrix.config }}-src*

        '
    - continue-on-error: true
      name: Build from ${{ matrix.config }}-src zip
      run: 'cd tmpbuild

        ant $OPTS -quiet build -Dcluster.config=${{ matrix.config }}

        '
    - continue-on-error: true
      if: ${{ (matrix.config == 'release') && success() }}
      name: Set up node
      uses: actions/setup-node@v4
      with:
        node-version: 18
    - continue-on-error: true
      if: ${{ (matrix.config == 'release') && success() }}
      name: Build NBVSCodeExt from ${{ matrix.config }}-src zip
      run: 'cd tmpbuild/java/java.lsp.server

        ant $OPTS build-vscode-ext -D3rdparty.modules=.*externalcodeformatter.*

        '
    strategy:
      fail-fast: false
      matrix:
        config:
        - platform
        - release
        java:
        - '17'
    timeout-minutes: 60
  build-system-test:
    name: Build-System / Misc Tests on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: Test Netbeans Build System
      run: ant $OPTS -Dcluster.config=$CLUSTER_CONFIG localtest
    - continue-on-error: true
      name: harness/o.n.insane
      run: ant $OPTS -f harness/o.n.insane test
    - continue-on-error: true
      name: harness/apisupport.harness
      run: ant $OPTS -f harness/apisupport.harness test
    - continue-on-error: true
      name: harness/harness/nbjunit
      run: ant $OPTS -f harness/nbjunit test
    - continue-on-error: true
      name: harness/jellytools.platform
      run: ant $OPTS -f harness/jellytools.platform test -Dtest.config=stable
    - continue-on-error: true
      name: ergonomics/ide.ergonomics
      run: ant $OPTS -f ergonomics/ide.ergonomics test -Dtest.config=commit
    - continue-on-error: true
      name: nb/deadlock.detector
      run: ant $OPTS -f nb/deadlock.detector test
    - continue-on-error: true
      name: nb/ide.branding
      run: ant $OPTS -f nb/ide.branding test
    - continue-on-error: true
      name: nb/o.n.upgrader
      run: ant $OPTS -f nb/o.n.upgrader test
    - continue-on-error: true
      name: Build nbms
      run: ant $OPTS build-nbms
    - continue-on-error: true
      if: env.test_javadoc == 'true' && success()
      name: Build javadoc
      run: ant $OPTS build-javadoc
    - continue-on-error: true
      if: env.test_tests == 'true' && github.event_name == 'pull_request' && success()
      name: Build all Tests
      run: ant -quiet -Dcluster.config=$CLUSTER_CONFIG test -Dtest.includes=NoTestsJustBuild
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 100
  build-tools:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'Ant') || contains(github.event.pull_request.labels.*.name,
      'Gradle') || contains(github.event.pull_request.labels.*.name, 'Maven') || contains(github.event.pull_request.labels.*.name,
      'MX') || contains(github.event.pull_request.labels.*.name, 'ci:all-tests') ||
      github.event_name != 'pull_request' }}
    name: Build-Tools on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: java/maven
      run: ant $OPTS -f java/maven test
    - continue-on-error: true
      name: java/maven.embedder
      run: ant $OPTS -f java/maven.embedder test
    - continue-on-error: true
      name: java/maven.grammar
      run: ant $OPTS -f java/maven.grammar test
    - continue-on-error: true
      name: java/maven.hints
      run: ant $OPTS -f java/maven.hints test
    - continue-on-error: true
      name: java/maven.indexer
      run: ant $OPTS -f java/maven.indexer test
    - continue-on-error: true
      name: java/maven.refactoring
      run: ant $OPTS -f java/maven.refactoring test
    - continue-on-error: true
      name: java/maven.junit
      run: ant $OPTS -f java/maven.junit test
    - continue-on-error: true
      name: java/maven.model
      run: ant $OPTS -f java/maven.model test
    - continue-on-error: true
      name: java/maven.osgi
      run: ant $OPTS -f java/maven.osgi test
    - continue-on-error: true
      name: java/api.maven
      run: ant $OPTS -f java/api.maven test
    - continue-on-error: true
      name: maven.apisupport
      run: ant $OPTS -f apisupport/maven.apisupport test
    - continue-on-error: true
      name: java/hudson.maven
      run: ant $OPTS -f java/hudson.maven test
    - continue-on-error: true
      name: ide/project.ant
      run: ant $OPTS -f ide/project.ant test
    - continue-on-error: true
      name: ide/project.ant.compat8
      run: ant $OPTS -f ide/project.ant.compat8 test
    - continue-on-error: true
      name: ide/project.ant.ui
      run: ant $OPTS -f ide/project.ant.ui test
    - continue-on-error: true
      name: java/ant.freeform
      run: ant $OPTS -f java/ant.freeform test
    - continue-on-error: true
      if: ${{ matrix.java == '17' }}
      name: java/java.mx.project
      run: .github/retry.sh ant $OPTS -f java/java.mx.project test
    - continue-on-error: true
      if: ${{ matrix.java == '17' }}
      name: java/gradle.java
      run: .github/retry.sh ant $OPTS -f java/gradle.java test
    - continue-on-error: true
      if: ${{ matrix.java == '17' }}
      name: extide/gradle
      run: ant $OPTS -f extide/gradle test
    - continue-on-error: true
      if: ${{ matrix.java == '17' }}
      name: java/gradle.dependencies
      run: ant $OPTS -f java/gradle.dependencies test
    - continue-on-error: true
      if: ${{ matrix.java == '17' }}
      name: extide/o.apache.tools.ant.module
      run: ant $OPTS -f extide/o.apache.tools.ant.module test
    - continue-on-error: true
      if: ${{ matrix.java == '17' }}
      name: apisupport.ant
      run: ant $OPTS -f apisupport/apisupport.ant test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        exclude:
        - java: ${{ github.event_name == 'pull_request' && 'nothing' || '21' }}
        java:
        - '17'
        - '21'
        - '22'
    timeout-minutes: 50
  cleanup:
    if: ${{ always() && needs.base-build.result == 'success' && (!contains(needs.*.result,
      'failure') || cancelled()) }}
    name: Cleanup Workflow Artifacts
    needs:
    - base-build
    - commit-validation
    - paperwork
    - build-system-test
    - build-from-src-zip
    - ide-modules-test
    - platform-modules-test1
    - platform-modules-test2
    - java-modules-test
    - java-hints-test
    - java-debugger-test
    - profiler-test
    - apisupport-modules-test
    - build-tools
    - webcommon-test
    - php
    - javafx-test
    - groovy-test
    - rust-test
    - enterprise-test
    - versioning-test
    - lsp-test
    - mysql-db-test
    - graalvm-test
    - vscode-extension-test
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Delete Workspace Artifact
      uses: geekyeggo/delete-artifact@v5
      with:
        name: build
        useGlob: false
    - continue-on-error: true
      if: ${{ contains(github.event.pull_request.labels.*.name, 'ci:dev-build') &&
        cancelled() }}
      name: Delete Dev Build Artifact
      uses: geekyeggo/delete-artifact@v5
      with:
        name: dev-build
        useGlob: false
    timeout-minutes: 60
  commit-validation:
    name: CV on ${{ matrix.os }}/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      if: contains(matrix.os, 'ubuntu') && success()
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      if: contains(matrix.os, 'macos') && success()
      name: Extract on MacOS
      run: unzstd -c build.tar.zst | tar -x
    - continue-on-error: true
      if: contains(matrix.os, 'macos') == false && success()
      name: Extract on Linux/Windows
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      if: contains(matrix.os, 'macos') && success()
      name: platform/masterfs.macosx
      run: .github/retry.sh ant $OPTS -f platform/masterfs.macosx test
    - continue-on-error: true
      name: Commit Validation tests
      run: .github/retry.sh ant $OPTS -Dcluster.config=$CLUSTER_CONFIG commit-validation
    - continue-on-error: true
      name: platform/core.network
      run: ant $OPTS -f platform/core.network test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: './*/*/build/test/*/results/TEST-*.xml

          ./nbbuild/build/test/commit-validation/results/TEST-*.xml

          '
    strategy:
      fail-fast: false
      matrix:
        include:
        - java: 22
          os: ubuntu-latest
        java:
        - 17
        os:
        - ubuntu-latest
        - macos-latest
        - windows-latest
    timeout-minutes: 40
  enterprise-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'Java EE/Jakarta EE')
      || contains(github.event.pull_request.labels.*.name, 'Micronaut') || contains(github.event.pull_request.labels.*.name,
      'enterprise') || contains(github.event.pull_request.labels.*.name, 'ci:all-tests')
      || github.event_name != 'pull_request' }}
    name: Enterprise on Linux/JDK ${{ matrix.java }} (some on 8)
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: micronaut
      run: .github/retry.sh ant $OPTS -f enterprise/micronaut test
    - continue-on-error: true
      name: api.web.webmodule
      run: ant $OPTS -f enterprise/api.web.webmodule test
    - continue-on-error: true
      name: cloud.amazon
      run: ant $OPTS -f enterprise/cloud.amazon test
    - continue-on-error: true
      name: cloud.oracle
      run: ant $OPTS -f enterprise/cloud.oracle test
    - continue-on-error: true
      name: el.lexer
      run: ant $OPTS -f enterprise/el.lexer test
    - continue-on-error: true
      name: glassfish.common
      run: ant $OPTS -f enterprise/glassfish.common test
    - continue-on-error: true
      name: j2ee.api.ejbmodule
      run: ant $OPTS -f enterprise/j2ee.api.ejbmodule test
    - continue-on-error: true
      name: j2ee.clientproject
      run: ant $OPTS -f enterprise/j2ee.clientproject test
    - continue-on-error: true
      name: j2ee.common
      run: ant $OPTS -f enterprise/j2ee.common test
    - continue-on-error: true
      name: j2ee.core
      run: ant $OPTS -f enterprise/j2ee.core test
    - continue-on-error: true
      name: j2ee.ddloaders
      run: ant $OPTS -f enterprise/j2ee.ddloaders test
    - continue-on-error: true
      name: j2ee.sun.appsrv
      run: ant $OPTS -f enterprise/j2ee.sun.appsrv test
    - continue-on-error: true
      name: j2ee.sun.dd
      run: ant $OPTS -f enterprise/j2ee.sun.dd test
    - continue-on-error: true
      name: javaee.wildfly
      run: .github/retry.sh ant $OPTS -f enterprise/javaee.wildfly test
    - continue-on-error: true
      name: jsp.lexer
      run: ant $OPTS -f enterprise/jsp.lexer test
    - continue-on-error: true
      name: maven.j2ee
      run: ant $OPTS -f enterprise/maven.j2ee test
    - continue-on-error: true
      name: profiler.j2ee
      run: ant $OPTS -f enterprise/profiler.j2ee test
    - continue-on-error: true
      name: spring.webmvc
      run: ant $OPTS -f enterprise/spring.webmvc test
    - continue-on-error: true
      name: spring.beans
      run: ant $OPTS -f java/spring.beans test
    - continue-on-error: true
      name: tomcat5
      run: ant $OPTS -f enterprise/tomcat5 test
    - continue-on-error: true
      name: web.jsf
      run: ant $OPTS -f enterprise/web.jsf test
    - continue-on-error: true
      name: web.jsfapi
      run: ant $OPTS -f enterprise/web.jsfapi test
    - continue-on-error: true
      name: websvc.clientapi
      run: ant $OPTS -f enterprise/websvc.clientapi test
    - continue-on-error: true
      name: websvc.jaxwsapi
      run: ant $OPTS -f enterprise/websvc.jaxwsapi test
    - continue-on-error: true
      name: websvc.projectapi
      run: ant $OPTS -f enterprise/websvc.projectapi test
    - continue-on-error: true
      name: websvc.rest
      run: ant $OPTS -f enterprise/websvc.rest test
    - continue-on-error: true
      name: websvc.websvcapi
      run: ant $OPTS -f enterprise/websvc.websvcapi test
    - continue-on-error: true
      name: websvc.wsstackapi
      run: ant $OPTS -f enterprise/websvc.wsstackapi test
    - continue-on-error: true
      name: Set up JDK 8 for incompatible tests
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: 8
    - continue-on-error: true
      name: websvc.editor.hints
      run: ant $OPTS -f enterprise/websvc.editor.hints test
    - continue-on-error: true
      name: j2ee.dd.webservice
      run: ant $OPTS -f enterprise/j2ee.dd.webservice test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 60
  graalvm-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'GraalVM') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: GraalVM ${{ matrix.graal }} Tests
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: Setup GraalVM ${{ matrix.graal }}
      run: 'URL=https://github.com/graalvm/graalvm-ce-builds/releases/download/vm-${{
        matrix.graal }}/graalvm-ce-java17-linux-amd64-${{ matrix.graal }}.tar.gz

        curl -L $URL | tar -xz

        GRAALVM=`pwd`/graalvm-ce-java17-${{ matrix.graal }}

        echo "JAVA_HOME=$GRAALVM" >> $GITHUB_ENV

        '
    - continue-on-error: true
      name: Setup GraalVM Languages (python, R, ruby and js)
      run: $JAVA_HOME/bin/gu install --no-progress python R ruby js
    - continue-on-error: true
      name: platform/core.network
      run: ant $OPTS -f platform/core.network test
    - continue-on-error: true
      name: platform/api.scripting
      run: ant $OPTS -f platform/api.scripting test
    - continue-on-error: true
      name: ide/libs.graalsdk
      run: ant $OPTS -f ide/libs.graalsdk test
    - continue-on-error: true
      name: webcommon/libs.graaljs
      run: ant $OPTS -f webcommon/libs.graaljs test
    - continue-on-error: true
      name: profiler/profiler.oql
      run: ant $OPTS -f profiler/profiler.oql test
    - continue-on-error: true
      name: java/nashorn.execution
      run: ant $OPTS -f java/nashorn.execution test
    - continue-on-error: true
      name: java/debugger.jpda.truffle
      run: .github/retry.sh ant $OPTS -f java/debugger.jpda.truffle test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        graal:
        - 22.3.1
    timeout-minutes: 60
  groovy-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'Groovy') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: Groovy on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: groovy/groovy.editor
      run: ant $OPTS -f groovy/groovy.editor test
    - continue-on-error: true
      name: groovy/groovy.gsp
      run: ant $OPTS -f groovy/groovy.gsp test
    - continue-on-error: true
      name: groovy/groovy.support
      run: ant $OPTS -f groovy/groovy.support test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 60
  ide-modules-test:
    name: IDE Modules on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: ide/api.xml
      run: ant $OPTS -f ide/api.xml test
    - continue-on-error: true
      name: ide/api.xml.ui
      run: ant $OPTS -f ide/api.xml.ui test
    - continue-on-error: true
      name: ide/bugtracking
      run: .github/retry.sh ant $OPTS -f ide/bugtracking test
    - continue-on-error: true
      name: ide/bugtracking.bridge
      run: .github/retry.sh ant $OPTS -f ide/bugtracking.bridge test
    - continue-on-error: true
      name: ide/bugtracking.commons
      run: ant $OPTS -f ide/bugtracking.commons test
    - continue-on-error: true
      name: ide/code.analysis
      run: ant $OPTS -f ide/code.analysis test
    - continue-on-error: true
      name: ide/core.ide
      run: ant $OPTS -f ide/core.ide test
    - continue-on-error: true
      name: ide/db
      run: .github/retry.sh ant $OPTS -f ide/db test
    - continue-on-error: true
      name: ide/db.dataview
      run: ant $OPTS -f ide/db.dataview test
    - continue-on-error: true
      name: ide/db.sql.editor
      run: ant $OPTS -f ide/db.sql.editor test
    - continue-on-error: true
      name: ide/docker.api
      run: ant $OPTS -f ide/docker.api test
    - continue-on-error: true
      name: ide/docker.ui
      run: ant $OPTS -f ide/docker.ui test
    - continue-on-error: true
      name: ide/editor.bookmarks
      run: ant $OPTS -f ide/editor.bookmarks test
    - continue-on-error: true
      name: ide/editor.document
      run: ant $OPTS -f ide/editor.document test
    - continue-on-error: true
      name: ide/editor.fold
      run: ant $OPTS -f ide/editor.fold test
    - continue-on-error: true
      name: ide/editor.fold.nbui
      run: ant $OPTS -f ide/editor.fold.nbui test
    - continue-on-error: true
      name: ide/editor.guards
      run: ant $OPTS -f ide/editor.guards test
    - continue-on-error: true
      name: ide/editor.indent
      run: ant $OPTS -f ide/editor.indent test
    - continue-on-error: true
      name: ide/editor.indent.project
      run: ant $OPTS -f ide/editor.indent.project test
    - continue-on-error: true
      name: ide/editor.macros
      run: ant $OPTS -f ide/editor.macros test
    - continue-on-error: true
      name: ide/editor.search
      run: ant $OPTS -f ide/editor.search test
    - continue-on-error: true
      name: ide/editor.settings
      run: ant $OPTS -f ide/editor.settings test
    - continue-on-error: true
      name: ide/editor.settings.storage
      run: .github/retry.sh ant $OPTS -f ide/editor.settings.storage test
    - continue-on-error: true
      name: ide/editor.structure
      run: ant $OPTS -f ide/editor.structure test
    - continue-on-error: true
      name: ide/editor.tools.storage
      run: ant $OPTS -f ide/editor.tools.storage test
    - continue-on-error: true
      name: ide/editor.util
      run: ant $OPTS -f ide/editor.util test
    - continue-on-error: true
      name: ide/extbrowser
      run: ant $OPTS -f ide/extbrowser test
    - continue-on-error: true
      name: ide/extexecution.base
      run: ant $OPTS -f ide/extexecution.base test
    - continue-on-error: true
      name: ide/gsf.testrunner.ui
      run: ant $OPTS -f ide/gsf.testrunner.ui test
    - continue-on-error: true
      name: ide/httpserver
      run: ant $OPTS -f ide/httpserver test
    - continue-on-error: true
      name: ide/hudson
      run: ant $OPTS -f ide/hudson test
    - continue-on-error: true
      name: ide/hudson.git
      run: ant $OPTS -f ide/hudson.git test
    - continue-on-error: true
      name: ide/hudson.mercurial
      run: ant $OPTS -f ide/hudson.mercurial test
    - continue-on-error: true
      name: ide/hudson.subversion
      run: ant $OPTS -f ide/hudson.subversion test
    - continue-on-error: true
      name: ide/hudson.tasklist
      run: ant $OPTS -f ide/hudson.tasklist test
    - continue-on-error: true
      name: ide/hudson.ui
      run: ant $OPTS -f ide/hudson.ui test
    - continue-on-error: true
      name: ide/javascript2.debug
      run: ant $OPTS -f ide/javascript2.debug test
    - continue-on-error: true
      name: ide/languages.hcl
      run: ant $OPTS -f ide/languages.hcl test
    - continue-on-error: true
      name: ide/languages.toml
      run: ant $OPTS -f ide/languages.toml test
    - continue-on-error: true
      name: ide/languages.yaml
      run: ant $OPTS -f ide/languages.yaml test
    - continue-on-error: true
      name: ide/lexer
      run: ant $OPTS -f ide/lexer test
    - continue-on-error: true
      name: ide/lexer.antlr4
      run: ant $OPTS -f ide/lexer.antlr4 test
    - continue-on-error: true
      name: ide/lib.terminalemulator
      run: ant $OPTS -f ide/lib.terminalemulator test
    - continue-on-error: true
      name: ide/libs.freemarker
      run: ant $OPTS -f ide/libs.freemarker test
    - continue-on-error: true
      name: ide/libs.graalsdk
      run: ant $OPTS -f ide/libs.graalsdk test
    - continue-on-error: true
      name: ide/libs.truffleapi
      run: ant $OPTS -f ide/libs.truffleapi test
    - continue-on-error: true
      name: ide/notifications
      run: .github/retry.sh ant $OPTS -f ide/notifications test
    - continue-on-error: true
      name: ide/o.openidex.util
      run: ant $OPTS -f ide/o.openidex.util test
    - continue-on-error: true
      name: ide/options.editor
      run: .github/retry.sh ant $OPTS -f ide/options.editor test
    - continue-on-error: true
      name: ide/parsing.lucene
      run: ant $OPTS -f ide/parsing.lucene test
    - continue-on-error: true
      name: ide/project.libraries
      run: ant $OPTS -f ide/project.libraries test
    - continue-on-error: true
      name: ide/project.libraries.ui
      run: ant $OPTS -f ide/project.libraries.ui test
    - continue-on-error: true
      name: ide/projectapi
      run: ant $OPTS -f ide/projectapi test
    - continue-on-error: true
      name: ide/projectapi.nb
      run: ant $OPTS -f ide/projectapi.nb test
    - continue-on-error: true
      name: ide/projectuiapi.base
      run: ant $OPTS -f ide/projectuiapi.base test
    - continue-on-error: true
      name: ide/refactoring.api
      run: ant $OPTS -f ide/refactoring.api test
    - continue-on-error: true
      name: ide/schema2beans
      run: ant $OPTS -f ide/schema2beans test
    - continue-on-error: true
      name: ide/server
      run: ant $OPTS -f ide/server test
    - continue-on-error: true
      name: ide/spellchecker
      run: ant $OPTS -f ide/spellchecker test
    - continue-on-error: true
      name: ide/spi.editor.hints
      run: ant $OPTS -f ide/spi.editor.hints test
    - continue-on-error: true
      name: ide/spi.tasklist
      run: ant $OPTS -f ide/spi.tasklist test
    - continue-on-error: true
      name: ide/tasklist.ui
      run: ant $OPTS -f ide/tasklist.ui test
    - continue-on-error: true
      name: ide/team.commons
      run: ant $OPTS -f ide/team.commons test
    - continue-on-error: true
      name: ide/terminal.nb
      run: ant $OPTS -f ide/terminal.nb test
    - continue-on-error: true
      name: ide/utilities
      run: ant $OPTS -f ide/utilities test
    - continue-on-error: true
      name: ide/web.common
      run: ant $OPTS -f ide/web.common test
    - continue-on-error: true
      name: ide/web.common.ui
      run: ant $OPTS -f ide/web.common.ui test
    - continue-on-error: true
      name: ide/web.webkit.debugging
      run: ant $OPTS -f ide/web.webkit.debugging test
    - continue-on-error: true
      name: ide/xml
      run: ant $OPTS -f ide/xml test
    - continue-on-error: true
      name: ide/xml.axi
      run: ant $OPTS -f ide/xml.axi test
    - continue-on-error: true
      name: ide/xml.catalog
      run: ant $OPTS -f ide/xml.catalog test-unit
    - continue-on-error: true
      name: ide/xml.core
      run: ant $OPTS -f ide/xml.core test
    - continue-on-error: true
      name: ide/xml.lexer
      run: ant $OPTS -f ide/xml.lexer test
    - continue-on-error: true
      name: ide/xml.multiview
      run: ant $OPTS -f ide/xml.multiview test
    - continue-on-error: true
      name: ide/xml.retriever
      run: ant $OPTS -f ide/xml.retriever test
    - continue-on-error: true
      name: ide/xml.schema.completion
      run: ant $OPTS -f ide/xml.schema.completion test
    - continue-on-error: true
      name: ide/xml.schema.model
      run: ant $OPTS -f ide/xml.schema.model test
    - continue-on-error: true
      name: ide/xml.text
      run: ant $OPTS -f ide/xml.text test
    - continue-on-error: true
      name: ide/xml.text.obsolete90
      run: ant $OPTS -f ide/xml.text.obsolete90 test
    - continue-on-error: true
      name: ide/xml.wsdl.model
      run: .github/retry.sh ant $OPTS -f ide/xml.wsdl.model test
    - continue-on-error: true
      name: ide/xml.xam
      run: ant $OPTS -f ide/xml.xam test
    - continue-on-error: true
      name: ide/xml.xdm
      run: ant $OPTS -f ide/xml.xdm test
    - continue-on-error: true
      name: ide/xsl
      run: ant $OPTS -f ide/xsl test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 60
  java-debugger-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'Java') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: Java Debugger tests on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: api.debugger.jpda
      run: ant $OPTS -f java/api.debugger.jpda test
    - continue-on-error: true
      name: debugger.jpda
      run: .github/retry.sh ant $OPTS -f java/debugger.jpda test
    - continue-on-error: true
      name: debugger.jpda.js
      run: ant $OPTS -f java/debugger.jpda.js test
    - continue-on-error: true
      name: debugger.jpda.projects
      run: .github/retry.sh ant $OPTS -f java/debugger.jpda.projects test
    - continue-on-error: true
      name: debugger.jpda.projectsui
      run: ant $OPTS -f java/debugger.jpda.projectsui test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        exclude:
        - java: ${{ github.event_name == 'pull_request' && 'nothing' || '21' }}
        java:
        - '17'
        - '21'
        - '22'
    timeout-minutes: 60
  java-hints-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'Java') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: Java Hints ${{ matrix.config }} on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: java.hints ${{ matrix.config }}
      run: ant $OPTS -Dtest.config=${{ matrix.config }} -f java/java.hints test
    - continue-on-error: true
      if: ${{ (matrix.config == 'batch2') && success() }}
      name: java.hints.declarative
      run: ant $OPTS -f java/java.hints.declarative test
    - continue-on-error: true
      if: ${{ (matrix.config == 'batch2') && success() }}
      name: spi.java.hints
      run: ant $OPTS -f java/spi.java.hints test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        config:
        - batch1
        - batch2
        exclude:
        - java: ${{ github.event_name == 'pull_request' && 'nothing' || '22' }}
        java:
        - '17'
        - '22'
    timeout-minutes: 60
  java-modules-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'Java') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: Java Modules on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: api.java
      run: ant $OPTS -f java/api.java test
    - continue-on-error: true
      name: classfile
      run: ant $OPTS -f java/classfile test
    - continue-on-error: true
      name: dbschema
      run: ant $OPTS -f java/dbschema test -Dtest.config=stable
    - continue-on-error: true
      name: editor.htmlui
      run: ant $OPTS -f java/editor.htmlui test
    - continue-on-error: true
      name: java.completion
      run: ant $OPTS -f java/java.completion test
    - continue-on-error: true
      name: java.editor.base
      run: ant $OPTS -f java/java.editor.base test
    - continue-on-error: true
      name: java.editor
      run: .github/retry.sh ant $OPTS -f java/java.editor test-unit
    - continue-on-error: true
      name: java.freeform
      run: ant $OPTS -f java/java.freeform test
    - continue-on-error: true
      name: java.module.graph
      run: ant $OPTS -f java/java.module.graph test
    - continue-on-error: true
      name: java.navigation
      run: ant $OPTS -f java/java.navigation test
    - continue-on-error: true
      name: java.openjdk.project
      run: ant $OPTS -f java/java.openjdk.project test
    - continue-on-error: true
      name: java.platform
      run: ant $OPTS -f java/java.platform test
    - continue-on-error: true
      name: java.platform.ui
      run: ant $OPTS -f java/java.platform.ui test
    - continue-on-error: true
      name: java.preprocessorbridge
      run: ant $OPTS -f java/java.preprocessorbridge test
    - continue-on-error: true
      name: java.project
      run: ant $OPTS -f java/java.project test
    - continue-on-error: true
      name: java.source
      run: ant $OPTS -f java/java.source test-unit
    - continue-on-error: true
      name: java.source.base
      run: ant $OPTS -f java/java.source.base test
    - continue-on-error: true
      name: java.source.compat8
      run: ant $OPTS -f java/java.source.compat8 test
    - continue-on-error: true
      name: java.source.queriesimpl
      run: ant $OPTS -f java/java.source.queriesimpl test
    - continue-on-error: true
      name: java.sourceui
      run: ant $OPTS -f java/java.sourceui test
    - continue-on-error: true
      name: java.testrunner
      run: ant $OPTS -f java/java.testrunner test
    - continue-on-error: true
      name: java.testrunner.ant
      run: ant $OPTS -f java/java.testrunner.ant test
    - continue-on-error: true
      name: jshell.support
      run: ant $OPTS -f java/jshell.support test
    - continue-on-error: true
      name: junit
      run: ant $OPTS -f java/junit test-unit
    - continue-on-error: true
      name: junit.ant.ui
      run: ant $OPTS -f java/junit.ant.ui test
    - continue-on-error: true
      name: lib.nbjavac
      run: ant $OPTS -f java/lib.nbjavac test
    - continue-on-error: true
      name: libs.nbjavacapi
      run: ant $OPTS -f java/libs.nbjavacapi test
    - continue-on-error: true
      name: spellchecker.bindings.java
      run: ant $OPTS -f java/spellchecker.bindings.java test
    - continue-on-error: true
      name: testng
      run: ant $OPTS -f java/testng test
    - continue-on-error: true
      name: whitelist
      run: ant $OPTS -f java/whitelist test
    - continue-on-error: true
      name: xml.jaxb
      run: ant $OPTS -f java/xml.jaxb test
    - continue-on-error: true
      name: java.lexer
      run: ant $OPTS -f java/java.lexer test
    - continue-on-error: true
      name: refactoring.java
      run: ant $OPTS -f java/refactoring.java test-unit
    - continue-on-error: true
      name: form
      run: ant $OPTS -f java/form test-unit
    - continue-on-error: true
      name: javadoc
      run: ant $OPTS -f java/javadoc test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 100
  javafx-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'JavaFX') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: JavaFX on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: platform/libs.javafx
      run: ant $OPTS -f platform/libs.javafx test
    - continue-on-error: true
      name: javafx2.editor
      run: ant $OPTS -f javafx/javafx2.editor test -Dtest.config=stable
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 60
  lsp-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'LSP') || contains(github.event.pull_request.labels.*.name,
      'Gradle') || contains(github.event.pull_request.labels.*.name, 'Maven') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: LSP tests on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: ide/lsp.client
      run: ant $OPTS -f ide/lsp.client test
    - continue-on-error: true
      name: java/java.lsp.server
      run: .github/retry.sh ant $OPTS -f java/java.lsp.server test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 60
  mysql-db-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'Java EE/Jakarta EE')
      || contains(github.event.pull_request.labels.*.name, 'Micronaut') || contains(github.event.pull_request.labels.*.name,
      'enterprise') || contains(github.event.pull_request.labels.*.name, 'ci:all-tests')
      || github.event_name != 'pull_request' }}
    name: DB Tests with MySQL on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    services:
      mysql:
        env:
          MYSQL_DATABASE: test
          MYSQL_ROOT_PASSWORD: test
        image: mysql:5.7
        options: --health-cmd="mysqladmin ping" --health-interval=10s --health-timeout=5s
          --health-retries=3
        ports:
        - 3306:3306
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: Setup Env
      run: 'echo "OPTS_TEST=-Dtest-unit-sys-prop.mysql.user=root -Dtest-unit-sys-prop.mysql.password=test
        -Dtest-unit-sys-prop.mysql.host=127.0.0.1" >> $GITHUB_ENV

        echo "ALTER USER ''root''@''localhost'' IDENTIFIED BY ''test'';\nFLUSH PRIVILEGES;\n"
        | mysql -h 127.0.0.1 --port 3306 -u root -ptest

        '
    - continue-on-error: true
      name: ide/db.metadata.model
      run: .github/retry.sh ant $OPTS $OPTS_TEST -f ide/db.metadata.model test
    - continue-on-error: true
      name: ide/db.mysql
      run: .github/retry.sh ant $OPTS $OPTS_TEST -f ide/db.mysql test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 60
  nb-javac-smokecheck:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'nb-javac') }}
    name: NetBeans on nb-javac
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Checkout ${{ github.ref }} ( ${{ github.sha }} )
      uses: actions/checkout@v4
      with:
        persist-credentials: false
        show-progress: false
        submodules: false
    - continue-on-error: true
      name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: 17
    - continue-on-error: true
      name: Caching dependencies
      uses: actions/cache/restore@v4
      with:
        key: ${{ runner.os }}-${{ hashFiles('*/external/binaries-list', '*/*/external/binaries-list')
          }}
        path: ~/.hgexternalcache
        restore-keys: ${{ runner.os }}-
    - continue-on-error: true
      name: Download External Binaries
      run: ant $OPTS download-all-extbins
    - continue-on-error: true
      name: Build NetBeans with nb-javac
      run: ant $OPTS build -Dnbjavac.class.path=java/libs.javacapi/external/*.jar
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Test with Commit Validation
      run: ant $OPTS commit-validation -Dnbjavac.class.path=java/libs.javacapi/external/*.jar
  paperwork:
    env:
      ANT_OPTS: -Dmetabuild.jsonurl=https://raw.githubusercontent.com/apache/netbeans-jenkins-lib/master/meta/netbeansrelease.json
    if: ${{ !cancelled() }}
    name: Check Paperwork on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      if: ${{ github.event_name == 'pull_request' && join(github.event.pull_request.labels.*.name)
        == '' }}
      name: Check PR labels
      run: 'echo "::error::PRs must be labeled, see: https://cwiki.apache.org/confluence/display/NETBEANS/PRs+and+You+-+A+reviewer+Guide"

        exit 1

        '
    - continue-on-error: true
      if: ${{ !cancelled() }}
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      if: ${{ !cancelled() }}
      name: Checkout ${{ github.ref }} ( ${{ github.sha }} )
      uses: actions/checkout@v4
      with:
        fetch-depth: 10
        persist-credentials: false
        show-progress: false
        submodules: false
    - continue-on-error: true
      if: ${{ github.event_name == 'pull_request' && !cancelled() }}
      name: Print last 10 Commits
      run: git log --oneline -n10 --pretty=format:'%h %an [%ae] %s'
    - continue-on-error: true
      if: ${{ !cancelled() }}
      name: Check line endings and verify RAT report
      run: 'nbbuild/travis/check-line-endings.sh

        ant $OPTS -quiet build-source-config

        mkdir scratch && cd scratch

        unzip -qq ../nbbuild/build/release-src*

        ant $OPTS -quiet rat -Drat-report.haltonfailure=true

        '
    - continue-on-error: true
      if: ${{ !cancelled() }}
      name: Clean Workspace
      run: cd ..; rm -Rf netbeans; mkdir netbeans
    - continue-on-error: true
      if: ${{ needs.base-build.result == 'success' && !cancelled() }}
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      if: ${{ needs.base-build.result == 'success' && !cancelled() }}
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      if: ${{ needs.base-build.result == 'success' && !cancelled() }}
      name: Verify libs and licenses
      run: ant $OPTS verify-libs-and-licenses -Dverify-libs-and-licenses.haltonfailure=true
    - continue-on-error: true
      if: ${{ needs.base-build.result == 'success' && !cancelled() }}
      name: Run check-sigtests-release
      run: ant $OPTS -quiet check-sigtests-release -Dfail.on.error=true
    - continue-on-error: true
      if: ${{ needs.base-build.result == 'success' && !cancelled() }}
      name: Run gen-sigtests-release
      run: ant $OPTS -quiet gen-sigtests-release
    strategy:
      matrix:
        java:
        - '17'
    timeout-minutes: 60
  php:
    defaults:
      run:
        shell: bash
        working-directory: ${{ contains(matrix.os, 'windows') && 'D:\\a\\ws' || github.workspace
          }}
    env:
      DISPLAY: :99.0
    if: ${{ contains(github.event.pull_request.labels.*.name, 'PHP') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: PHP on ${{ matrix.os }}/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      if: contains(matrix.os, 'windows')
      name: Symlink short paths for windows
      run: mklink /d D:\\a\\ws ${{ github.workspace }}
      shell: cmd
      working-directory: ${{ github.workspace }}
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      if: contains(matrix.os, 'ubuntu')
      name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        extensions: xdebug
        ini-values: xdebug.mode=debug
        php-version: '8.3'
        tools: pecl
    - continue-on-error: true
      if: contains(matrix.os, 'ubuntu')
      name: Setup Xvfb
      run: Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: hudson.php
      run: ant $OPTS -f php/hudson.php test
    - continue-on-error: true
      name: languages.neon
      run: ant $OPTS -f php/languages.neon test
    - continue-on-error: true
      name: php.api.annotation
      run: ant $OPTS -f php/php.api.annotation test
    - continue-on-error: true
      name: php.api.documentation
      run: ant $OPTS -f php/php.api.documentation test
    - continue-on-error: true
      name: php.api.executable
      run: ant $OPTS -f php/php.api.executable test
    - continue-on-error: true
      name: php.api.framework
      run: ant $OPTS -f php/php.api.framework test
    - continue-on-error: true
      name: php.api.phpmodule
      run: ant $OPTS -f php/php.api.phpmodule test
    - continue-on-error: true
      name: php.api.testing
      run: ant $OPTS -f php/php.api.testing test
    - continue-on-error: true
      name: php.apigen
      run: ant $OPTS -f php/php.apigen test
    - continue-on-error: true
      name: php.atoum
      run: ant $OPTS -f php/php.atoum test
    - continue-on-error: true
      name: php.code.analysis
      run: ant $OPTS -f php/php.code.analysis test
    - continue-on-error: true
      name: php.codeception
      run: ant $OPTS -f php/php.codeception test
    - continue-on-error: true
      name: php.composer
      run: ant $OPTS -f php/php.composer test
    - continue-on-error: true
      if: contains(matrix.os, 'ubuntu')
      name: php.dbgp
      run: ant $OPTS -f php/php.dbgp test
    - continue-on-error: true
      name: php.doctrine2
      run: ant $OPTS -f php/php.doctrine2 test
    - continue-on-error: true
      name: php.editor
      run: ant $OPTS -Dtest.config=stable -f php/php.editor test
    - continue-on-error: true
      name: php.editor (unreliable tests)
      run: .github/retry.sh ant $OPTS -Dtest.config=unreliable -f php/php.editor test
    - continue-on-error: true
      name: php.latte
      run: ant $OPTS -f php/php.latte test
    - continue-on-error: true
      name: php.nette.tester
      run: ant $OPTS -f php/php.nette.tester test
    - continue-on-error: true
      name: php.phpunit
      run: ant $OPTS -f php/php.phpunit test
    - continue-on-error: true
      name: php.project
      run: ant $OPTS -f php/php.project test
    - continue-on-error: true
      name: php.refactoring
      run: ant $OPTS -f php/php.refactoring test
    - continue-on-error: true
      name: php.smarty
      run: ant $OPTS -f php/php.smarty test
    - continue-on-error: true
      name: php.symfony
      run: ant $OPTS -f php/php.symfony test
    - continue-on-error: true
      name: php.symfony2
      run: ant $OPTS -f php/php.symfony2 test
    - continue-on-error: true
      name: php.twig
      run: ant $OPTS -f php/php.twig test
    - continue-on-error: true
      name: php.zend
      run: ant $OPTS -f php/php.zend test
    - continue-on-error: true
      name: php.zend2
      run: ant $OPTS -f php/php.zend2 test
    - continue-on-error: true
      name: spellchecker.bindings.php
      run: ant $OPTS -f php/spellchecker.bindings.php test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        exclude:
        - os: ${{ github.event_name == 'pull_request' && 'nothing' || 'windows-latest'
            }}
        java:
        - '17'
        os:
        - windows-latest
        - ubuntu-latest
    timeout-minutes: 120
  platform-modules-test1:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'Platform') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: Platform Modules batch1 on Linux/JDK ${{ matrix.java }} (some on 8)
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: platform/api.htmlui
      run: .github/retry.sh ant $OPTS -f platform/api.htmlui test
    - continue-on-error: true
      name: platform/htmlui
      run: .github/retry.sh ant $OPTS -f platform/htmlui test
    - continue-on-error: true
      name: platform/api.intent
      run: ant $OPTS -f platform/api.intent test
    - continue-on-error: true
      name: platform/api.io
      run: ant $OPTS -f platform/api.io test
    - continue-on-error: true
      name: platform/api.progress
      run: ant $OPTS -f platform/api.progress test
    - continue-on-error: true
      name: platform/api.progress.nb
      run: ant $OPTS -f platform/api.progress.nb test
    - continue-on-error: true
      name: platform/api.scripting
      run: ant $OPTS -f platform/api.scripting test
    - continue-on-error: true
      name: platform/api.search
      run: ant $OPTS -f platform/api.search test
    - continue-on-error: true
      name: platform/api.visual
      run: ant $OPTS -f platform/api.visual test
    - continue-on-error: true
      name: platform/applemenu
      run: ant $OPTS -f platform/applemenu test
    - continue-on-error: true
      name: platform/autoupdate.cli
      run: ant $OPTS -f platform/autoupdate.cli test
    - continue-on-error: true
      name: platform/autoupdate.services
      run: ant $OPTS -f platform/autoupdate.services test
    - continue-on-error: true
      name: platform/autoupdate.ui
      run: ant $OPTS -f platform/autoupdate.ui test
    - continue-on-error: true
      name: platform/core.execution
      run: ant $OPTS -f platform/core.execution test
    - continue-on-error: true
      name: platform/core.io.ui
      run: ant $OPTS -f platform/core.io.ui test
    - continue-on-error: true
      name: platform/core.kit
      run: ant $OPTS -f platform/core.kit test
    - continue-on-error: true
      name: platform/core.multiview
      run: ant $OPTS -f platform/core.multiview test
    - continue-on-error: true
      name: platform/core.netigso
      run: ant $OPTS -f platform/core.netigso test
    - continue-on-error: true
      name: platform/core.osgi
      run: ant $OPTS -f platform/core.osgi test
    - continue-on-error: true
      name: platform/core.output2
      run: ant $OPTS -f platform/core.output2 test
    - continue-on-error: true
      name: platform/core.startup
      run: .github/retry.sh ant $OPTS -f platform/core.startup test
    - continue-on-error: true
      name: platform/core.startup.base
      run: ant $OPTS -f platform/core.startup.base test
    - continue-on-error: true
      name: platform/core.ui
      run: ant $OPTS -f platform/core.ui test
    - continue-on-error: true
      name: platform/core.windows
      run: .github/retry.sh ant $OPTS -f platform/core.windows test
    - continue-on-error: true
      name: platform/editor.mimelookup
      run: ant $OPTS -f platform/editor.mimelookup test
    - continue-on-error: true
      name: platform/editor.mimelookup.impl
      run: ant $OPTS -f platform/editor.mimelookup.impl test
    - continue-on-error: true
      name: platform/favorites
      run: .github/retry.sh ant $OPTS -f platform/favorites test
    - continue-on-error: true
      name: platform/javahelp
      run: ant $OPTS -f platform/javahelp test-unit
    - continue-on-error: true
      name: platform/keyring.fallback
      run: ant $OPTS -f platform/keyring.fallback test
    - continue-on-error: true
      name: platform/keyring.impl
      run: ant $OPTS -f platform/keyring.impl test
    - continue-on-error: true
      name: platform/libs.junit4
      run: ant $OPTS -f platform/libs.junit4 test
    - continue-on-error: true
      name: platform/masterfs
      run: .github/retry.sh ant $OPTS -f platform/masterfs test
    - continue-on-error: true
      name: platform/masterfs.linux
      run: ant $OPTS -f platform/masterfs.linux test
    - continue-on-error: true
      name: platform/o.n.core
      run: ant $OPTS -f platform/o.n.core test-unit
    - continue-on-error: true
      name: platform/o.n.swing.outline
      run: ant $OPTS -f platform/o.n.swing.outline test
    - continue-on-error: true
      name: platform/o.n.swing.tabcontrol
      run: ant $OPTS -f platform/o.n.swing.tabcontrol test
    - continue-on-error: true
      name: Set up JDK 8 for incompatibe tests
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: 8
    - continue-on-error: true
      name: platform/lib.uihandler
      run: .github/retry.sh ant $OPTS -f platform/lib.uihandler test
    - continue-on-error: true
      name: platform/openide.text
      run: .github/retry.sh ant $OPTS -f platform/openide.text test
    - continue-on-error: true
      name: platform/openide.util.ui
      run: ant $OPTS -f platform/openide.util.ui test
    - continue-on-error: true
      name: isolate platform build
      run: 'cp -r platform/ _platform/ && cp -r harness/ _harness/ && cp nbbuild/build/nbantext.jar
        .

        cp -r nbbuild/netbeans/platform/ _nb_platform/ && cp -r nbbuild/netbeans/harness/
        _nb_harness/

        ant $OPTS -quiet clean && rm -Rf platform/ && rm -Rf harness/

        mkdir nbbuild/build && mkdir nbbuild/netbeans

        mv _platform/ platform/ && mv _harness/ harness/ && mv nbantext.jar nbbuild/build/

        mv _nb_platform/ nbbuild/netbeans/platform/ && mv _nb_harness/ nbbuild/netbeans/harness/

        '
    - continue-on-error: true
      name: platform/netbinox
      run: ant $OPTS -f platform/netbinox test -Dtest.config=stableBTD
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 60
  platform-modules-test2:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'Platform') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: Platform Modules batch2 on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: platform/openide.actions
      run: ant $OPTS -f platform/openide.actions test
    - continue-on-error: true
      name: platform/openide.awt
      run: ant $OPTS -f platform/openide.awt test
    - continue-on-error: true
      name: platform/openide.compat
      run: ant $OPTS -f platform/openide.compat test
    - continue-on-error: true
      name: platform/openide.dialogs
      run: ant $OPTS -f platform/openide.dialogs test
    - continue-on-error: true
      name: platform/openide.execution
      run: ant $OPTS -f platform/openide.execution test
    - continue-on-error: true
      name: platform/openide.execution.compat8
      run: ant $OPTS -f platform/openide.execution.compat8 test
    - continue-on-error: true
      name: platform/openide.explorer
      run: .github/retry.sh ant $OPTS -f platform/openide.explorer test
    - continue-on-error: true
      name: platform/openide.filesystems
      run: ant $OPTS -f platform/openide.filesystems test
    - continue-on-error: true
      name: platform/openide.filesystems.compat8
      run: ant $OPTS -f platform/openide.filesystems.compat8 test
    - continue-on-error: true
      name: platform/openide.filesystems.nb
      run: ant $OPTS -f platform/openide.filesystems.nb test
    - continue-on-error: true
      name: platform/openide.io
      run: ant $OPTS -f platform/openide.io test
    - continue-on-error: true
      name: platform/openide.loaders
      run: ant $OPTS -f platform/openide.loaders test
    - continue-on-error: true
      name: platform/openide.modules
      run: ant $OPTS -f platform/openide.modules test
    - continue-on-error: true
      name: platform/openide.nodes
      run: ant $OPTS -f platform/openide.nodes test
    - continue-on-error: true
      name: platform/openide.options
      run: ant $OPTS -f platform/openide.options test
    - continue-on-error: true
      name: platform/openide.util
      run: ant $OPTS -f platform/openide.util test
    - continue-on-error: true
      name: platform/openide.util.lookup
      run: ant $OPTS -f platform/openide.util.lookup test
    - continue-on-error: true
      name: platform/openide.windows
      run: ant $OPTS -f platform/openide.windows test
    - continue-on-error: true
      name: platform/options.api
      run: ant $OPTS -f platform/options.api test-unit
    - continue-on-error: true
      name: platform/options.keymap
      run: ant $OPTS -f platform/options.keymap test
    - continue-on-error: true
      name: platform/print
      run: ant $OPTS -f platform/print test
    - continue-on-error: true
      name: platform/progress.ui
      run: ant $OPTS -f platform/progress.ui test
    - continue-on-error: true
      name: platform/queries
      run: ant $OPTS -f platform/queries test
    - continue-on-error: true
      name: platform/sampler
      run: ant $OPTS -f platform/sampler test
    - continue-on-error: true
      name: platform/sendopts
      run: ant $OPTS -f platform/sendopts test
    - continue-on-error: true
      name: platform/settings
      run: .github/retry.sh ant $OPTS -f platform/settings test
    - continue-on-error: true
      name: platform/spi.actions
      run: ant $OPTS -f platform/spi.actions test
    - continue-on-error: true
      name: platform/spi.quicksearch
      run: ant $OPTS -f platform/spi.quicksearch test
    - continue-on-error: true
      name: platform/templatesui
      run: ant $OPTS -f platform/templatesui test
    - continue-on-error: true
      name: platform/uihandler
      run: .github/retry.sh ant $OPTS -f platform/uihandler test
    - continue-on-error: true
      name: platform/o.n.bootstrap
      run: ant $OPTS -f platform/o.n.bootstrap test
    - continue-on-error: true
      name: Set up JDK 11 for platform/templates
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: 11
    - continue-on-error: true
      name: platform/templates
      run: ant $OPTS -f platform/templates test
    - continue-on-error: true
      name: platform/api.templates
      run: ant $OPTS -f platform/api.templates test
    - continue-on-error: true
      name: platform/openide.loaders TemplatesMimeTypeTest
      run: ant $OPTS -f platform/openide.loaders test -Dtest.config.default.includes=**/TemplatesMimeTypeTest.class
        -Dtest.config.default.excludes=""
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 90
  profiler-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'Java') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: Profiler on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: profiler
      run: ant $OPTS -f profiler/profiler test-unit
    - continue-on-error: true
      name: profiler.oql
      run: ant $OPTS -f profiler/profiler.oql test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '11'
    timeout-minutes: 60
  rust-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'Rust') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: Rust on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: rust/rust.cargo
      run: ant $OPTS -f rust/rust.cargo test
    - continue-on-error: true
      name: rust/rust.grammar
      run: ant $OPTS -f rust/rust.grammar test
    - continue-on-error: true
      name: rust/rust.options
      run: ant $OPTS -f rust/rust.options test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 60
  versioning-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'git') || contains(github.event.pull_request.labels.*.name,
      'subversion') || contains(github.event.pull_request.labels.*.name, 'mercurial')
      || contains(github.event.pull_request.labels.*.name, 'ci:all-tests') || github.event_name
      != 'pull_request' }}
    name: Versioning Modules on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: Setup Env
      run: echo "GIT_TEST_REPO=$HOME/git_test_repo" >> $GITHUB_ENV
    - continue-on-error: true
      name: ide/git
      run: .github/retry.sh ant $OPTS -f ide/git test-unit
    - continue-on-error: true
      name: ide/libs.git
      run: .github/retry.sh ant $OPTS -f ide/libs.git test
    - continue-on-error: true
      name: ide/versioning.masterfs
      run: ant $OPTS -f ide/versioning.masterfs test
    - continue-on-error: true
      name: ide/versioning.ui
      run: ant $OPTS -f ide/versioning.ui test
    - continue-on-error: true
      name: ide/versioning.util
      run: ant $OPTS -f ide/versioning.util test
    - continue-on-error: true
      name: ide/versioning.core
      run: ant $OPTS -f ide/versioning.core test-unit
    - continue-on-error: true
      name: ide/versioning
      run: ant $OPTS -f ide/versioning test-unit
    - continue-on-error: true
      name: ide/versioning.core test-qa-functional
      run: '#Prepare git repo for tests

        git init $GIT_TEST_REPO

        # Prepare config file for ide/versioning.core module

        touch ide/versioning.core/test/qa-functional/data/tck.properties

        echo "test.root = $GIT_TEST_REPO" > ide/versioning.core/test/qa-functional/data/tck.properties

        echo "test.vcs = org.netbeans.modules.versioning.DelegatingVCS" >> ide/versioning.core/test/qa-functional/data/tck.properties

        # Run functional tests for ide/versioning.core module

        ant $OPTS -f ide/versioning.core test-qa-functional

        '
    - continue-on-error: true
      name: ide/versioning test-qa-functional
      run: '# Prepare config file for ide/versioning module

        touch ide/versioning/test/qa-functional/data/tck.properties

        echo "test.root = $GIT_TEST_REPO" > ide/versioning/test/qa-functional/data/tck.properties

        echo "test.vcs = org.netbeans.modules.git.GitVCS" >> ide/versioning/test/qa-functional/data/tck.properties

        # Run functional tests for ide/versioning module

        ant $OPTS -f ide/versioning test-qa-functional

        '
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 60
  vscode-extension-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'VSCode Extension')
      || contains(github.event.pull_request.labels.*.name, 'ci:all-tests') || github.event_name
      != 'pull_request' }}
    name: VSCode Extension Tests on JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Set up node
      uses: actions/setup-node@v4
      with:
        node-version: 18
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: build-vscode-ext
      run: 'cd java/java.lsp.server

        ant $OPTS build-vscode-ext -D3rdparty.modules=.*externalcodeformatter.*

        '
    - continue-on-error: true
      name: test-vscode-ext
      run: 'cd java/java.lsp.server

        env "netbeans.extra.options=-J-Dnetbeans.logger.console=true" ant $OPTS test-vscode-ext

        '
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 60
  webcommon-test:
    if: ${{ contains(github.event.pull_request.labels.*.name, 'JavaScript') || contains(github.event.pull_request.labels.*.name,
      'TypeScript') || contains(github.event.pull_request.labels.*.name, 'HTML') ||
      contains(github.event.pull_request.labels.*.name, 'CSS') || contains(github.event.pull_request.labels.*.name,
      'CSL') || contains(github.event.pull_request.labels.*.name, 'web') || contains(github.event.pull_request.labels.*.name,
      'ci:all-tests') || github.event_name != 'pull_request' }}
    name: Web Modules on Linux/JDK ${{ matrix.java }}
    needs: base-build
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: ${{ matrix.java }}
    - continue-on-error: true
      name: Setup Xvfb
      run: 'echo "DISPLAY=:99.0" >> $GITHUB_ENV

        Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &

        '
    - continue-on-error: true
      name: Download Build
      uses: actions/download-artifact@v4
      with:
        name: build
    - continue-on-error: true
      name: Extract
      run: tar --zstd -xf build.tar.zst
    - continue-on-error: true
      name: ide/csl.api
      run: ant $OPTS -f ide/csl.api test
    - continue-on-error: true
      name: ide/csl.types
      run: ant $OPTS -f ide/csl.types test
    - continue-on-error: true
      name: ide/css.editor
      run: ant $OPTS -f ide/css.editor test
    - continue-on-error: true
      name: ide/css.lib
      run: ant $OPTS -f ide/css.lib test
    - continue-on-error: true
      name: ide/css.model
      run: ant $OPTS -f ide/css.model test
    - continue-on-error: true
      name: ide/html
      run: .github/retry.sh ant $OPTS -f ide/html test
    - continue-on-error: true
      name: ide/html.custom
      run: ant $OPTS -f ide/html.custom test
    - continue-on-error: true
      name: ide/html.editor
      run: ant $OPTS -f ide/html.editor test
    - continue-on-error: true
      name: ide/html.editor
      run: ant $OPTS -f ide/html.editor.lib test
    - continue-on-error: true
      name: ide/html.lexer
      run: ant $OPTS -f ide/html.lexer test
    - continue-on-error: true
      name: ide/html.parser
      run: ant $OPTS -f ide/html.parser test
    - continue-on-error: true
      name: ide/html.validation
      run: ant $OPTS -f ide/html.validation test
    - continue-on-error: true
      name: webcommon/html.angular
      run: ant $OPTS -f webcommon/html.angular test-unit
    - continue-on-error: true
      name: webcommon/html.knockout
      run: ant $OPTS -f webcommon/html.knockout test-unit
    - continue-on-error: true
      name: webcommon/javascript.bower
      run: ant $OPTS -f webcommon/javascript.bower test
    - continue-on-error: true
      name: webcommon/javascript.cdnjs
      run: ant $OPTS -f webcommon/javascript.cdnjs test
    - continue-on-error: true
      name: webcommon/javascript.grunt
      run: ant $OPTS -f webcommon/javascript.grunt test
    - continue-on-error: true
      name: webcommon/javascript.karma
      run: ant $OPTS -f webcommon/javascript.karma test
    - continue-on-error: true
      name: webcommon/javascript.nodejs
      run: ant $OPTS -f webcommon/javascript.nodejs test
    - continue-on-error: true
      name: webcommon/javascript.v8debug
      run: ant $OPTS -f webcommon/javascript.v8debug test
    - continue-on-error: true
      name: webcommon/javascript2.doc
      run: ant $OPTS -f webcommon/javascript2.doc test
    - continue-on-error: true
      if: env.test_javascript == 'true' && success()
      name: webcommon/javascript2.editor
      run: ant $OPTS -f webcommon/javascript2.editor test-unit
    - continue-on-error: true
      name: webcommon/javascript2.extdoc
      run: ant $OPTS -f webcommon/javascript2.extdoc test
    - continue-on-error: true
      name: webcommon/javascript2.extjs
      run: ant $OPTS -f webcommon/javascript2.extjs test
    - continue-on-error: true
      name: webcommon/javascript2.jade
      run: ant $OPTS -f webcommon/javascript2.jade test
    - continue-on-error: true
      name: webcommon/javascript2.jquery
      run: .github/retry.sh ant $OPTS -f webcommon/javascript2.jquery test
    - continue-on-error: true
      name: webcommon/javascript2.jsdoc
      run: ant $OPTS -f webcommon/javascript2.jsdoc test
    - continue-on-error: true
      name: webcommon/javascript2.json
      run: ant $OPTS -f webcommon/javascript2.json test
    - continue-on-error: true
      name: webcommon/javascript2.knockout
      run: ant $OPTS -f webcommon/javascript2.knockout test
    - continue-on-error: true
      name: webcommon/javascript2.lexer
      run: ant $OPTS -f webcommon/javascript2.lexer test
    - continue-on-error: true
      name: webcommon/javascript2.model
      run: ant $OPTS -f webcommon/javascript2.model test
    - continue-on-error: true
      name: webcommon/javascript2.nodejs
      run: ant $OPTS -f webcommon/javascript2.nodejs test-unit
    - continue-on-error: true
      name: webcommon/javascript2.prototypejs
      run: ant $OPTS -f webcommon/javascript2.prototypejs test
    - continue-on-error: true
      name: webcommon/javascript2.requirejs
      run: ant $OPTS -f webcommon/javascript2.requirejs test-unit
    - continue-on-error: true
      name: webcommon/javascript2.sdoc
      run: ant $OPTS -f webcommon/javascript2.sdoc test
    - continue-on-error: true
      name: webcommon/languages.apacheconf
      run: ant $OPTS -f webcommon/languages.apacheconf test
    - continue-on-error: true
      name: webcommon/languages.ini
      run: ant $OPTS -f webcommon/languages.ini test
    - continue-on-error: true
      name: webcommon/libs.graaljs
      run: ant $OPTS -f webcommon/libs.graaljs test
    - continue-on-error: true
      name: webcommon/selenium2.webclient
      run: ant $OPTS -f webcommon/selenium2.webclient test
    - continue-on-error: true
      name: webcommon/web.clientproject
      run: ant $OPTS -f webcommon/web.clientproject test-unit
    - continue-on-error: true
      name: webcommon/web.clientproject.api
      run: ant $OPTS -f webcommon/web.clientproject.api test
    - continue-on-error: true
      name: webcommon/web.inspect
      run: ant $OPTS -f webcommon/web.inspect test
    - continue-on-error: true
      name: Set up JDK 11 for webcommon/api.knockout
      uses: actions/setup-java@v4
      with:
        distribution: ${{ env.DEFAULT_JAVA_DISTRIBUTION }}
        java-version: 11
    - continue-on-error: true
      name: webcommon/api.knockout
      run: ant $OPTS -f webcommon/api.knockout test
    - continue-on-error: true
      if: failure()
      name: Create Test Summary
      uses: test-summary/action@v2
      with:
        paths: ./*/*/build/test/*/results/TEST-*.xml
    strategy:
      fail-fast: false
      matrix:
        java:
        - '17'
    timeout-minutes: 60
name: NetBeans
on:
  repository_dispatch:
    types: trigger-ga___main.yml
